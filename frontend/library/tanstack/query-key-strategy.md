> π“… Date: 2025-07-31

# π“ Focus
- TanStack Query: Query Key μ„¤κ³„ μ „λµ
- μΏΌλ¦¬ ν‚¤ κµ¬μ΅°ν™”, λ™μ  νλΌλ―Έν„°, μ¤‘μ²© ν‚¤, μΊμ‹± μ „λµ
<br />

# π“ Learnings

## Query Key
- TanStack Query(React Query)μ—μ„ μΏΌλ¦¬μ κ³ μ μ„±μ„ κ²°μ •ν•λ” ν•µμ‹¬ μ”μ†
- μΏΌλ¦¬ ν‚¤κ°€ λ‹¤λ¥΄λ©΄ μ„λ΅ λ‹¤λ¥Έ λ°μ΄ν„°λ΅ μΈμ‹λμ–΄ λ³„λ„μ μΊμ‹ κ³µκ°„μ— μ €μ¥
- μΏΌλ¦¬ ν‚¤κ°€ κ°™μΌλ©΄ λ™μΌν• λ°μ΄ν„°λ΅ κ°„μ£Όλμ–΄ μΊμ‹ κ³µμ 
- μΏΌλ¦¬ ν‚¤ μ„¤κ³„λ” λ°μ΄ν„° μΌκ΄€μ„±, μΊμ‹± ν¨μ¨, μ„±λ¥ μµμ ν™”μ— μ§μ ‘μ μΈ μν–¥

<br />

## Query Keyμ κΈ°λ³Έ κµ¬μ΅°μ™€ μ„¤κ³„ μ›μΉ™

### λ°°μ—΄ κΈ°λ° κµ¬μ΅°
- λ¬Έμμ—΄μ΄ μ•„λ‹ λ°°μ—΄λ΅ μ„¤κ³„ν•λ” κ²ƒμ΄ κ¶μ¥λλ‹¤.
- λ°°μ—΄μ κ° μ”μ†λ” μΏΌλ¦¬μ κ³„μΈµμ  μλ―Έ ν‘ν„
<br />

```js
// λ‹¨μ λ¬Έμμ—΄ (λΉ„μ¶”μ²)
useQuery('user', fetchUser)

// λ°°μ—΄ κΈ°λ° (κ¶μ¥)
useQuery(['user', userId], fetchUser)
```

- μ²« λ²μ§Έ μ”μ†: λ¦¬μ†μ¤μ νƒ€μ…(μ: 'user', 'posts')
- λ‘ λ²μ§Έ μ΄ν›„ μ”μ†: μ‹λ³„μ, νλΌλ―Έν„°, ν•„ν„° λ“±
<br />

### λ…ν™•ν•κ³  μΌκ΄€λ λ„¤μ΄λ°
- λ¦¬μ†μ¤μ μΆ…λ¥, λ©μ , νλΌλ―Έν„°λ¥Ό λ…ν™•ν κµ¬λ¶„
- μ¤‘μ²© κµ¬μ΅°λ¥Ό ν™μ©ν•΄ κ³„μΈµμ  μλ―Έλ¥Ό λ¶€μ—¬
- μμ‹: `['posts', 'list', { page: 1, filter: 'hot' }]`

<br />

## λ™μ  νλΌλ―Έν„°μ™€ μ¤‘μ²© ν‚¤ μ„¤κ³„

### λ™μ  νλΌλ―Έν„° ν™μ©
API μ”μ²­μ— λ”°λΌ λ™μ μΌλ΅ λ³€ν•λ” κ°’(μ: userId, page, filter λ“±)μ€ μΏΌλ¦¬ ν‚¤μ λ‘ λ²μ§Έ μ΄ν›„ μ”μ†λ΅ λ…ν™•ν λ¶„λ¦¬
<br />

```js
useQuery(['user', userId], fetchUser)
useQuery(['posts', { page, filter }], fetchPosts)
```

- κ°μ²΄λ¥Ό νλΌλ―Έν„°λ΅ μΏΌλ¦¬ ν‚¤μ— ν¬ν•¨ν•  λ•λ” μμ„μ™€ μ†μ„±λ…μ΄ μΌκ΄€λκ² μ μ§€λμ–΄μ•Ό ν•¨
- λ¶ν•„μ”ν• κ°’(μ: undefined, null)μ€ ν¬ν•¨ν•μ§€ μ•λ” κ²ƒμ΄ μΆ‹μ

### μ¤‘μ²© ν‚¤ μ„¤κ³„
λ³µμ΅ν• λ°μ΄ν„° κµ¬μ΅°λ‚ κ³„μΈµμ  λ¦¬μ†μ¤(μ: ν”„λ΅μ νΈ > κ²μ‹κΈ€ > λ“κΈ€)μ—μ„λ” μ¤‘μ²© λ°°μ—΄λ΅ μ„¤κ³„
<br />

```js
useQuery(['projects', projectId, 'posts', postId, 'comments'], fetchComments)
```

- κ³„μΈµ κµ¬μ΅°λ¥Ό λ…ν™•ν ν‘ν„ν•μ—¬, λ¶€λ¶„ λ¬΄ν¨ν™”(invalidate)λ‚ refetch μ‹ μ μ—°ν•κ² λ€μ‘ κ°€λ¥

<br />

## μΊμ‹± μ „λµκ³Ό μΏΌλ¦¬ ν‚¤μ κ΄€κ³„

### μΊμ‹ λ¶„λ¦¬μ™€ κ³µμ 
- μΏΌλ¦¬ ν‚¤κ°€ λ‹¤λ¥΄λ©΄ λ³„λ„μ μΊμ‹ κ³µκ°„μ— μ €μ¥λ¨ β†’ λ°μ΄ν„° μ¶©λ λ°©μ§€
- μΏΌλ¦¬ ν‚¤κ°€ κ°™μΌλ©΄ λ™μΌν• μΊμ‹λ¥Ό κ³µμ  β†’ λ¶ν•„μ”ν• λ„¤νΈμ›ν¬ μ”μ²­ λ°©μ§€

### Query Invalidation(λ¬΄ν¨ν™”)μ™€ Refetch
- μΏΌλ¦¬ ν‚¤λ¥Ό κ³„μΈµμ μΌλ΅ μ„¤κ³„ν•λ©΄, μƒμ„ λ¦¬μ†μ¤ λ³€κ²½ μ‹ ν•μ„ λ¦¬μ†μ¤λ§ λ¶€λ¶„μ μΌλ΅ λ¬΄ν¨ν™” κ°€λ¥
- μμ‹: `queryClient.invalidateQueries(['projects', projectId])` β†’ ν•΄λ‹Ή ν”„λ΅μ νΈμ λ¨λ“  ν•μ„ λ°μ΄ν„° λ¬΄ν¨ν™”

### StaleTime, CacheTimeκ³Όμ μ—°κ³„
- μΏΌλ¦¬ ν‚¤λ³„λ΅ staleTime, cacheTimeμ„ λ‹¤λ¥΄κ² μ„¤μ •ν•΄ λ°μ΄ν„° μ‹ μ„ λ„μ™€ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ„ μ΅°μ 

<br />

## μ‹¤λ¬΄ μ μ© μ‹ κ³ λ ¤μ‚¬ν•­

### μΌκ΄€μ„± μλ” μΏΌλ¦¬ ν‚¤ λ„¤μ΄λ° μ»¨λ²¤μ…
- ν€ λ‚΄μ—μ„ μΏΌλ¦¬ ν‚¤ λ„¤μ΄λ° κ·μΉ™μ„ λ¬Έμ„ν™”ν•κ³ , λ¨λ“  μΏΌλ¦¬μ— λ™μΌν•κ² μ μ©
- μμ‹: `[λ¦¬μ†μ¤, μ‹λ³„μ, μ„Έλ¶€νƒ€μ…, νλΌλ―Έν„°]` μμ„λ΅ ν†µμΌ

### νλΌλ―Έν„° κ°μ²΄μ μ§λ ¬ν™” μ£Όμ
- κ°μ²΄λ¥Ό μΏΌλ¦¬ ν‚¤μ— ν¬ν•¨ν•  λ•λ” μμ„, μ†μ„±λ…, κ°’μ΄ ν•­μƒ λ™μΌν•κ² μƒμ„±λλ„λ΅ μ£Όμ
- λ¶ν•„μ”ν• μ†μ„±, undefined/null κ°’μ€ μ κ±°
- JSON.stringifyλ¥Ό μ§μ ‘ μ‚¬μ©ν•μ§€ λ§κ³ , TanStack Query λ‚΄λ¶€ μ§λ ¬ν™” λ°©μ‹μ„ μ‹ λΆ°

### λ¶ν•„μ”ν• μΏΌλ¦¬ ν‚¤ λ¶„ν• /μ¤‘λ³µ λ°©μ§€
- λ™μΌν• λ°μ΄ν„°λ¥Ό μ—¬λ¬ ν‚¤λ΅ μΌκ°μ„ κ΄€λ¦¬ν•λ©΄ μΊμ‹κ°€ λ¶„μ‚°λμ–΄ λΉ„ν¨μ¨μ 
- λ°λ€λ΅, λ„λ¬΄ ν¬κ΄„μ μΈ ν‚¤λ” λ¶ν•„μ”ν• refetch/λ¬΄ν¨ν™”λ΅ μ΄μ–΄μ§ μ μμ

### invalidateQueries/ refetchQueries ν™μ©
- κ³„μΈµμ  μΏΌλ¦¬ ν‚¤ μ„¤κ³„λ¥Ό ν†µν•΄, μƒμ„ λ¦¬μ†μ¤ λ³€κ²½ μ‹ ν•μ„ λ¦¬μ†μ¤λ§ λ¶€λ¶„μ μΌλ΅ λ¬΄ν¨ν™”
- μμ‹: κ²μ‹κΈ€ μμ • μ‹ `['posts', postId]`λ§ invalidate, μ „μ²΄ λ¦¬μ¤νΈλ” κ·Έλ€λ΅ μ μ§€

### SSR/Prefetch/Infinite Queryμ™€μ μ—°κ³„
- SSR/Prefetch μ‹μ—λ„ λ™μΌν• μΏΌλ¦¬ ν‚¤λ¥Ό μ‚¬μ©ν•΄μ•Ό ν΄λΌμ΄μ–ΈνΈμ™€ μΊμ‹κ°€ μΌμΉ
- Infinite Queryμ—μ„λ” νμ΄μ§€ νλΌλ―Έν„°λ¥Ό μΏΌλ¦¬ ν‚¤μ— λ…ν™•ν ν¬ν•¨

<br />

## μ‹¤μ „ μμ μ™€ ν¨ν„΄

### κΈ°λ³Έ ν¨ν„΄
```js
// λ‹¨μΌ λ¦¬μ†μ¤
useQuery(['user', userId], fetchUser)

// λ¦¬μ¤νΈ + νλΌλ―Έν„°
useQuery(['posts', { page, filter }], fetchPosts)

// μ¤‘μ²© λ¦¬μ†μ¤
useQuery(['projects', projectId, 'posts', postId, 'comments'], fetchComments)
```

### λ¶€λ¶„ λ¬΄ν¨ν™”
```js
// νΉμ • ν”„λ΅μ νΈμ λ¨λ“  λ°μ΄ν„° λ¬΄ν¨ν™”
queryClient.invalidateQueries(['projects', projectId])

// νΉμ • κ²μ‹κΈ€λ§ λ¬΄ν¨ν™”
queryClient.invalidateQueries(['posts', postId])
```

### λ™μ  νλΌλ―Έν„° κ°μ²΄ κ΄€λ¦¬
```js
// νλΌλ―Έν„° κ°μ²΄λ¥Ό μΏΌλ¦¬ ν‚¤μ— ν¬ν•¨ν•  λ•, undefined/null μ κ±°
const queryKey = ['posts', { page: page || 1, filter: filter || 'all' }]
useQuery(queryKey, fetchPosts)
```

### Infinite Query
```js
useInfiniteQuery(['posts', { filter }], fetchInfinitePosts, {
  getNextPageParam: lastPage => lastPage.nextCursor,
})
```

---

## μ—¬λ¬ κ³ λ―Όλ“¤ 

### "μ™ invalidateQueriesκ°€ μ• λ¨Ήνμ§€?"
- μΏΌλ¦¬ ν‚¤μ— ν¬ν•¨λ κ°μ²΄μ μ†μ„± μμ„, κ°’μ΄ λ‹¤λ¥΄λ©΄ λ‹¤λ¥Έ μΏΌλ¦¬λ΅ μΈμ‹λ¨
- ν•­μƒ λ™μΌν• μμ„μ™€ κ°’μΌλ΅ μΏΌλ¦¬ ν‚¤λ¥Ό μƒμ„±ν•΄μ•Ό ν•¨

### "λ™μΌν• λ°μ΄ν„°μΈλ° μΊμ‹κ°€ λ¶„μ‚°λλ‹¤"
- νλΌλ―Έν„°κ°€ λ‹¤λ¥΄κ² λ“¤μ–΄κ°€κ±°λ‚, λ¶ν•„μ”ν• κ°’μ΄ ν¬ν•¨λλ©΄ μΊμ‹κ°€ λ¶„μ‚°λ¨
- μΏΌλ¦¬ ν‚¤ μƒμ„± λ΅μ§μ„ util ν•¨μλ΅ ν†µμΌν•λ” κ²ƒλ„ λ°©λ²•

### "λ¦¬μ¤νΈμ™€ μƒμ„Έ μΏΌλ¦¬μ ν‚¤λ¥Ό μ–΄λ–»κ² λ‚λκΉ?"
- λ¦¬μ¤νΈ: `['posts', { page, filter }]`
- μƒμ„Έ: `['posts', postId]`
- λ¦¬μ¤νΈ λ¬΄ν¨ν™” μ‹ μƒμ„Έλ” μ μ§€, μƒμ„Έ λ¬΄ν¨ν™” μ‹ λ¦¬μ¤νΈλ” μν–¥ μ—†μ

### "μ¤‘μ²© λ¦¬μ†μ¤μ—μ„ invalidate λ²”μ„ μ μ–΄"
- κ³„μΈµμ μΌλ΅ μ„¤κ³„ν•λ©΄ μƒμ„/ν•μ„ λ¦¬μ†μ¤λ§ λ¶€λ¶„μ μΌλ΅ λ¬΄ν¨ν™” κ°€λ¥
- μ: `['projects', projectId, 'posts']` β†’ ν•΄λ‹Ή ν”„λ΅μ νΈμ κ²μ‹κΈ€λ§ λ¬΄ν¨ν™”

### "SSR/Prefetchμ™€ μΏΌλ¦¬ ν‚¤ μΌμΉ"
- μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ¨λ‘ λ™μΌν• μΏΌλ¦¬ ν‚¤ μƒμ„± λ΅μ§μ„ μ‚¬μ©ν•΄μ•Ό μΊμ‹κ°€ μΌμΉ
- μΏΌλ¦¬ ν‚¤ μƒμ„± μ ν‹Έμ„ λ³„λ„ νμΌλ΅ λ¶„λ¦¬ν•΄ κ³µμ 

<br />

# π”— References
- [TanStack Query κ³µμ‹ λ¬Έμ„: Query Keys](https://tanstack.com/query/latest/docs/framework/react/guides/query-keys)
- [Query Invalidation & Refetching](https://tanstack.com/query/latest/docs/framework/react/guides/query-invalidation)
- [React Query Patterns: Query Key Design](https://tkdodo.eu/blog/effective-react-query-keys)
- [TanStack Query GitHub Discussions](https://github.com/TanStack/query/discussions)
